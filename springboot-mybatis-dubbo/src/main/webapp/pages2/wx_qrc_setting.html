<!DOCTYPE html>
<!-- saved from url=(0057)http://mnsppds.huishengdianz.com/s/54/wx_qrc_setting.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		
		<meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=0, width=device-width">
		<title>设置</title>
		<link rel="stylesheet" type="text/css" href="./设置_files/api.css">
		<style type="text/css">
			html,
			body {
				background-color: #000;
				height: 100%;
			}
			.imgContainer{
				width: 100%;
				overflow: hidden;
				overflow-y: auto;	
				position: relative;			
			}
			.imgContainer img{
				display: block;
				visibility:hidden;
			}
			.imgContainer>i{
				position: absolute;
				left: 50%;
				top: 50%;
				-webkit-transform: translateX(-50%) translateY(-50%);
				-moz-transform: translateX(-50%) translateY(-50%);
				-ms-transform: translateX(-50%) translateY(-50%);
				-o-transform: translateX(-50%) translateY(-50%);
				transform: translateX(-50%) translateY(-50%);
				width: 30px;
				height: 30px;
				background-image: url(img/loading1.gif);
				background-size: 100% 100%;
			}
			/*打分*/			
			.mark_contation {
				position: absolute;
				left: 0;
				bottom:0px;
				width: 100%;
				height: 175px;
				background-color: rgba(255, 255, 255, 1);
				z-index: 1;
			}
			
			.mark_body {
				position: absolute;
				left: 50%;
				top: 0px;
				width:auto;
				min-width: 300px;
				-webkit-transform: translate(-50%, 0%);
				-moz-transform: translate(-50%, 0%);
				-ms-transform: translate(-50%, 0%);
				-o-transform: translate(-50%, 0%);
				transform: translate(-50%, 0%);
				margin-top: 10px;
			}
			
			.slide {
				width: 100%;
				position: relative;
				display: inline-block;
				padding-left: 15px;
			}
			.text{
				position: absolute;
				top: 0px;
				left: 0px;
			}
			.controlbar-box {
				position: relative;
				width: 200px;
				height: 14px;
			}
			
			.controlbar-box .c-bg {
				position: absolute;
				left: 45px;
				top: 7px;
				width: 100%;
				height: 2px;
				background: #08a506;
				border-radius: 30px;
			}
			
			.controlbar-box .c-bg1 {
				position: absolute;
				left: 45px;
				top: 7px;
				width: 100%;
				height: 2px;
				background: #d3d3d3;
				border-radius: 30px;
				z-index: 2;
			}
			
			.controlbar-box .c-round {
				position: absolute;
				left: 45px;
				top: -4px;
				z-index: 99;
				width: 24px;
				height: 24px;
				line-height: 24px;
				background-color: #09be07;
				border-radius: 50%;
				cursor: pointer;
				text-align: center;
				color: #fff;
			}
			.controlbar-box .c-progress{
				position:absolute; 
				right:-70px; 
				top:0px; 
				z-index:8; 
				width:20px;
			}

			.mark {
				margin: 10px auto 0;
				text-align: center;
			}
			
			.mark input {
				width: 50px;
				height: 25px;
				background-color: #e6e6e6;
				margin: 0 7px 0 7px;
				border-radius: 5px;
				text-align: center;
				color: #098707;				
			}	
			.btns{
				width: 300px;
				position: relative;	
				margin: 5px auto 0;	
				text-align: center;
			}

			.middleText{
				height: 40px;
				line-height: 40px;
				background-color: #09be07;
				padding: 0 20px;
				margin-top: 5px;
				color: #fff;
				border-radius: 7px;
			}

			.suijiSelect{
				display: inline-block;
				vertical-align: middle;
				width: 20px;
				height: 20px;
				border: 1px solid #ccc;
				background-position: center;
				background-repeat: no-repeat;
				background-size: 12px 12px;
				margin: 0 5px;				
			}
			.bg_dui{
				background-image: url(img/dui.png);
			}
		</style>
	</head>

	<body>
		<script type="text/javascript">
			 //图片居中显示  
			function center_img(dom) {
				dom.style.visibility = 'hidden';
				var pWideth = dom.parentNode.offsetWidth;
				var pHeight = dom.parentNode.offsetHeight;
				var Wideth = dom.width;
				var Height = dom.height;
				if(Wideth >= Height){
					dom.width = pWideth;
					if(dom.height >= pHeight){
						dom.width = dom.width * pHeight / dom.height;
						dom.height = pHeight;	
					}	
				}else{
					dom.height = pHeight;
					if(dom.width >= pWideth){
						dom.height = dom.height * pWideth / dom.width;
						dom.width = pWideth;	
					}	
				}
				dom.style.marginLeft = (pWideth - dom.width) / 2 + 'px';
				dom.style.marginTop = (pHeight - dom.height) / 2 + 'px';
				dom.style.visibility = 'visible';
			}
		</script>
		<div class="imgContainer" id="imgContainer" style="height: 507px;">
			<img id="imgID" src="http://mnsppds.huishengdianz.com/s/54/wx_qrc_setting.html" onload="center_img(this);">
		</div>
		<script type="text/javascript">
			var srceenHeight = document.body.clientHeight || window.innerHeight || document.documentElement.clientWidth;
			document.getElementById("imgContainer").style.height = srceenHeight - 160 + 'px';
		</script>
		<div class="mark_contation" id="mark_contation">
			<div class="mark_body">
				<div class="slide">				
					<div class="controlbar-box">
						<div class="text">模糊：</div>
						<div class="c-round" id="c_roud"></div>
						<div class="c-bg1"></div>
						<div class="c-bg"></div>
						<div class="c-progress" id="blurNumber"></div>
					</div>
				</div>
				<div class="mark">
					<div>(只能输入<span id="mylimit"></span>到<span id="mymaxAmountLimit"></span>之间)</div>
					<div style="margin: 5px 0;">
						打赏 :
						<span id="dao"><input type="text" id="mininputNumber" onblur="onblurNum(this,1)" value="1" onkeyup="inputNumberF(this,1)">元 到</span>
						<input type="text" id="inputNumber" onblur="onblurNum(this,2)" value="3" onkeyup="inputNumberF(this,2)">元 												
					</div>
					
					<span id="suijiSelect" class="suijiSelect bg_dui"></span>
					<span>随机
						<span id="randomNum">
							(<label style="color: #098707;" id="minlableNumber">1</label>到<label id="lableNumber" style="color: #098707;">3</label>元)
						</span>						
					</span>
						<span id="download" class="suijiSelect no"></span>
						<span id="download-text">是否提供下载</span>
				</div>
				<div class="btns">
					<span class="middleText" id="set">设置并生成模糊图</span>
				</div>
			</div>
		</div>
		<script src="./设置_files/jquery_v2.1.4.min.js.下载" type="text/javascript" charset="utf-8"></script>
		<script src="./设置_files/myc.js.下载" type="text/javascript"></script>
		<script type="text/javascript">

			myc.showProgress({
				rgba : 0.8
			});
			var k = ap = code = t = '';
			var mylimit = '';
			var mymaxAmountLimit = '';
			//获取url的参数
			if(my.getQuery()){
				k = my.getQuery().k;
				ap = my.getQuery().ap;
				code = my.getQuery().code;
				t = my.getQuery().t;
				// alert('key:' + k);
				getImgInfo();								
			}
					
			//获取图片信息
			function getImgInfo(){
				myc.showProgress();
				my.ajax('load/' + k + '?ap=' + ap + '&code=' + code + '&t=' + t,{},function(ret,err,status){
					 // alert("获取信息:"+JSON.stringify(ret));			
					myc.hideProgress();
					if(ret && ret.success){
						mylimit = ret.detail.minAmountLimit;
						mymaxAmountLimit = ret.detail.maxAmountLimit;
						// alert(mylimit)
						$('#imgID').attr('src',ret.detail.blurUrl);
						if(ret.detail.type == 1){
							$('#download-text').css('display','none');
							$('.no').css('display','none');
						}	
						var bar_round = document.querySelector('.c-round'); //小圆
						var bar_num = document.querySelector('.c-bg'); //白色线
						var sigmao = ret.detail.blur;
						var sigma = sigmao / 100 * $('.controlbar-box').width();
						var offwidth = $('.controlbar-box').width() - $('.c-round').width();
						if(offwidth <= sigma){
							sigma = offwidth;
						}
						bar_round.style.left = sigma + 45 + 'px';
						bar_num.style.width = sigma + 'px';
						bar_num.style.zIndex = '20';
						document.querySelector('.c-progress').innerHTML = sigmao;
						
						$('#inputNumber').val(parseFloat(ret.detail.price));
						$('#lableNumber').html(parseFloat(ret.detail.price));
						$('#mininputNumber').val(parseFloat(ret.detail.price_min));
						$('#minlableNumber').html(parseFloat(ret.detail.price_min));
						$('#mylimit').html(parseFloat(mylimit));
						$('#mymaxAmountLimit').html(parseFloat(mymaxAmountLimit));

						// 记住金额
						if(!ret.detail.random){
							$('#suijiSelect').removeClass('bg_dui');
							$('#randomNum').css('display','none');
							$('#dao').css('display','none');
						}else{
							$('#suijiSelect').addClass('bg_dui');
						}
						// 下载记住
						if(!ret.detail.download){
							$('#download').removeClass('bg_dui');
						}else{
							$('#download').addClass('bg_dui');
						}
						$('#mark_contation').css('display','block');
					}else{
						if(ret.blackUrl) {
							window.location.href = ret.blackUrl;
						}					
						if(ret.block){
							window.location.href =  ret.blackUrl;
						}
					}
				});
			}

			// 选择下载
			$('#download').click(function(){
				if($(this).hasClass('bg_dui')){
					 // alert('不下载')
					$(this).removeClass('bg_dui');
				}else{
					 // alert('下载')
					$(this).addClass('bg_dui');
				}
			});
			//随机
			$('#suijiSelect').click(function(){
				if($(this).hasClass('bg_dui')){
					$(this).removeClass('bg_dui');
					$('#randomNum').css('display','none');	
					$('#dao').css('display','none');
				}else{
					$(this).addClass('bg_dui');
					$('#randomNum').css('display','inline-block');
					$('#dao').css('display','inline-block');
				}
				var mininputNumber = $('#mininputNumber').val().replace(/\.$/g, "");
				var inputNumber = $('#inputNumber').val().replace(/\.$/g, "");
				if(parseFloat(mininputNumber) > parseFloat(inputNumber)){
					$('#inputNumber').val(mininputNumber);
					$('#lableNumber').html(mininputNumber);
				}
			});
			
			//设置
			$('#set').click(function(){
				// 下载
				if($('#download').hasClass('bg_dui')){
					// alert('下载')
					var download = 1;
				}else{
					// alert('不下载')
					var download = 0;
				}
				
				// 最小值
				var random = 0;
				if($('#suijiSelect').hasClass('bg_dui')){
					var random = 1;
				}
				
				var amount = parseFloat($('#inputNumber').val()).toFixed(2);
				var amount_min = parseFloat($('#mininputNumber').val()).toFixed(2);
				
				if(random == 0){
					amount_min = amount;
				}

				if(amount_min < mylimit){
					myc.toast({
						msg : '必须要大于' + mylimit +'元' 
					});
					return false;
				}
				
				if(amount < mylimit){
					myc.toast({
						msg : '必须要大于' + mylimit +'元' 
					});
					return false;
				}
				// 最大值
				if(amount > mymaxAmountLimit){
					myc.toast({
						msg : '必须要小于' + mymaxAmountLimit +'元' 
					});
					return false;
				}
				if(!amount){
					myc.toast({
						msg : '您输入的不是数字哦'
					});
					return false;
				}
				if(!amount_min){
					myc.toast({
						msg : '您输入的不是数字哦'
					});
					return false;
				}
				
				
				var blurNumber = $('#blurNumber').html();
				if(amount > 0){
					myc.showProgress({
						title : '设置并生成中...',
						rgba : 0
					});			
		
					my.ajax('generate/' + k,{
						imageLayout :0,
						price : amount,
						priceMin : amount_min,
						random : random,
						share : 1,
						blur : blurNumber,
						download : download
					},function(ret,err,status){
						myc.hideProgress();
							// alert('设置并生成ret:'+JSON.stringify(ret)+'err:'+JSON.stringify(err)+'status:'+JSON.stringify(status));
						if(ret && ret.success){
							myc.toast({
								msg : '设置并生成成功！',
								location : 'middle'
							});
							setTimeout(function(){
								wx.closeWindow();
							},2000);
						}else{
							myc.toast({
								msg : '设置并生成失败，请重新设置！'
							});
						}
					});
				}else{
					myc.toast({
						msg : '金额不能为零'
					});
				}
			});
			
			//设置模糊图
			function setBlur(){
				if($('#suijiSelect').hasClass('bg_dui')){
					var random = 1;
				}else{
					var random = 0;
				}
				var amount = parseFloat($('#inputNumber').val()).toFixed(2);
				var amount_min = parseFloat($('#mininputNumber').val()).toFixed(2);
				if(amount <= 0){
					myc.toast({
						msg : '金额不能为零'
					});
					return false;
				}
				if(!amount){
					myc.toast({
						msg : '您输入的不是数字哦'
					});
					return false;
				}
				if(!amount_min){
					myc.toast({
						msg : '您输入的不是数字哦'
					});
					return false;
				}
				var blurNumber = $('#blurNumber').html();
				
				if(parseInt(blurNumber) < 20){
					myc.alert({
						msg : '模糊度不能小于20'
					})
					var bar_round = document.querySelector('.c-round'); //小圆
					var bar_num = document.querySelector('.c-bg'); //白色线
					var sigmao = 20;
					
					
					var sigma = sigmao / 100 * $('.controlbar-box').width();
					var offwidth = $('.controlbar-box').width() - $('.c-round').width();
					if(offwidth <= sigma){
						sigma = offwidth;
					}
					bar_round.style.left = sigma + 45 + 'px';
					bar_num.style.width = sigma + 'px';
					bar_num.style.zIndex = '20';
					document.querySelector('.c-progress').innerHTML = sigmao;
					blurNumber = sigmao;
					// return false;
				}
				
				if(amount){
					myc.showProgress({
						title : '设置中...',
						rgba : 0
					});				
					my.ajax('set/' + k,{
						imageLayout :0,
						price : amount,
						priceMin : amount_min,
						random : random,
						share : 1,
						blur : blurNumber
					},function(ret,err,status){
						myc.hideProgress();
						// alert('设置ret:'+JSON.stringify(ret)+'err:'+JSON.stringify(err)+'status:'+JSON.stringify(status));
						if(ret && ret.success){
							$('#imgID').attr('src',ret.blurImage + '?t=' + (new Date().getTime()));	
							myc.toast({
								msg : '设置成功！',
								location : 'middle'
							});

						}else{
							myc.toast({
								msg : '设置失败，请重新设置！'
							});
						}
					});
				}else{
					myc.toast({
						msg : '请输入金额'
					});
				}
			}
									
			function onblurNum(dom,style){
				var mininputNumber = $('#mininputNumber').val().replace(/\.$/g, "");
				var inputNumber = $('#inputNumber').val().replace(/\.$/g, "");
				$('#lableNumber').html(inputNumber);
				$('#minlableNumber').html(mininputNumber);
	
				if(!mininputNumber){
					$('#mininputNumber').val(1);
					$('#minlableNumber').html(1);
				}
				
				if(!inputNumber){
					$('#inputNumber').val(1);
					$('#lableNumber').html(1);
				}
				if(!$('#suijiSelect').hasClass('bg_dui')){
					return false;
				}
				if(style == 1){					
					if(parseFloat(mininputNumber) > parseFloat(inputNumber)){
						$('#inputNumber').val(mininputNumber);
						$('#lableNumber').html(mininputNumber);
					}
				}else{					
					if(parseFloat(inputNumber) < parseFloat(mininputNumber)){
						$('#inputNumber').val(mininputNumber);
						$('#lableNumber').html(mininputNumber);
					}
				}
			}
			
			function inputNumberF(dom,style) {
				if(style == 1){
					dom.value =dom.value.replace(/[^\d.]/g, "").replace(/^\./g, "").replace(/\.{2,}/g, ".").replace(".", "$#$").replace(/\./g, "").replace("$#$", ".").replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3');
					if(dom.value){
						if(dom.value > 99){
							dom.value = 99;
							$('#minlableNumber').html(99);						
						}else{
							$('#minlableNumber').html(dom.value);
						}					
					}else{
						// dom.value = 0;
						$('#minlableNumber').html(0);
					}	
				}else{
					dom.value =dom.value.replace(/[^\d.]/g, "").replace(/^\./g, "").replace(/\.{2,}/g, ".").replace(".", "$#$").replace(/\./g, "").replace("$#$", ".").replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3');
					if(dom.value){
						if(dom.value > 99){
							dom.value = 99;
							$('#lableNumber').html(99);						
						}else{
							$('#lableNumber').html(dom.value);
						}					
					}else{
						// dom.value = 0;
						$('#lableNumber').html(0);
					}	
				}
							
			}

			$(function() {
				var _bar = document.querySelector('.controlbar-box'); //父元素
				var bar_round = document.querySelector('.c-round'); //小圆
				var bar_num = document.querySelector('.c-bg'); //白色线
				mark();	
				function mark() {
					var mark_body = document.querySelector('.mark_body');
					//圆宽度的一半
					var x = parseInt(bar_round.offsetWidth) / 2;
					var max_w = _bar.offsetWidth - x; //在没有offset().left时的最大x坐标
					var bar_offsetLeft = $('.controlbar-box').offset().left + 45; //元素和左窗体的距离:用不到e.pageY和.offset()top
					function drags(event) {
						var _pagex = event.touches[0].pageX; //得到指针x轴坐标
						
						//判断e.pageX 
						if (_pagex < bar_offsetLeft + x) { //最左边	：_pagex最小时
							_pagex = bar_offsetLeft;
						} else if (_pagex > max_w + bar_offsetLeft) { //最右边：_pagex最大时
							_pagex = max_w + bar_offsetLeft - x;
						} else {
							_pagex = _pagex - x;
						}
						//小圆定位
						//					bar_round.style.position = 'absolute';
						// roundleft=_pagex - bar_offsetLeft;
						bar_round.style.left = (_pagex - bar_offsetLeft+45) + 'px';
						bar_num.style.width = (_pagex - bar_offsetLeft) + 'px';
						bar_num.style.zIndex = '20';
						//得到数值%
						var ratio = Math.abs(_pagex - bar_offsetLeft) / (max_w - x);
						document.querySelector('.c-progress').innerHTML = Math.ceil(ratio * 100);

						// $('#imgID').css('-webkit-filter','blur('+ Math.ceil(ratio * 100) +'px)');
						// 					document.querySelector('#c_roud').innerText = Math.ceil(ratio * 100);
					}
					//元素按下事件	
					_bar.addEventListener('touchstart', bar_down, false);

					function bar_down() {
						event.preventDefault(); //阻止元素的默认事件
						event.stopPropagation(); // 阻止元素冒泡事件
						drags(event);
						//					_bar.onclick = function(event){//元素点击事件
						//						drags(event);
						//					}
					}
					_bar.addEventListener('touchmove', touchmove, false);

					function touchmove(event) {
						event.preventDefault(); //阻止元素的默认事件
						event.stopPropagation(); // 阻止元素冒泡事件
						drags(event);
					}
					//document按下弹起事件
					_bar.addEventListener('touchend', function(event) {
						event.preventDefault(); //阻止元素的默认事件
						event.stopPropagation(); // 阻止元素冒泡事件
						document.removeEventListener('touchmove', touchmove, false);
						setBlur();
					}, false);
				}
			});
		</script><div id="showProgressBackground" style="position: fixed;width: 100%;height: 100%;left: 0;top: 0;background-color: rgba(0,0,0,0.8);z-index:999999"></div><div id="showProgressContainer" style="position: fixed;left: 50%;top: 50%;-webkit-transform:  translateX(-50%) translateY(-50%);-moz-transform:  translateX(-50%) translateY(-50%);-ms-transform:  translateX(-50%) translateY(-50%);-o-transform:  translateX(-50%) translateY(-50%);transform:  translateX(-50%) translateY(-50%);background-color: rgba(0,0,0,1);color: #fff;padding: 15px;border-radius: 5px;text-align: center;min-height: 115px;min-width: 115px;z-index:999999"><div class="showProgressLoading"></div><div id="showProgressTitle" style="padding: 5px 0;color:#fff">努力加载中...</div><div id="showProgressText" style="color:#fff">请稍候...</div></div>
		<script src="./设置_files/jweixin-1.0.0.js.下载"></script>	
	

<audio controls="controls" style="display: none;"></audio></body><style type="text/css">#yddContainer{display:block;font-family:Microsoft YaHei;position:relative;width:100%;height:100%;top:-4px;left:-4px;font-size:12px;border:1px solid}#yddTop{display:block;height:22px}#yddTopBorderlr{display:block;position:static;height:17px;padding:2px 28px;line-height:17px;font-size:12px;color:#5079bb;font-weight:bold;border-style:none solid;border-width:1px}#yddTopBorderlr .ydd-sp{position:absolute;top:2px;height:0;overflow:hidden}.ydd-icon{left:5px;width:17px;padding:0px 0px 0px 0px;padding-top:17px;background-position:-16px -44px}.ydd-close{right:5px;width:16px;padding-top:16px;background-position:left -44px}#yddKeyTitle{float:left;text-decoration:none}#yddMiddle{display:block;margin-bottom:10px}.ydd-tabs{display:block;margin:5px 0;padding:0 5px;height:18px;border-bottom:1px solid}.ydd-tab{display:block;float:left;height:18px;margin:0 5px -1px 0;padding:0 4px;line-height:18px;border:1px solid;border-bottom:none}.ydd-trans-container{display:block;line-height:160%}.ydd-trans-container a{text-decoration:none;}#yddBottom{position:absolute;bottom:0;left:0;width:100%;height:22px;line-height:22px;overflow:hidden;background-position:left -22px}.ydd-padding010{padding:0 10px}#yddWrapper{color:#252525;z-index:10001;background:url(chrome-extension://eopjamdnofihpioajgfdikhhbobonhbb/ab20.png);}#yddContainer{background:#fff;border-color:#4b7598}#yddTopBorderlr{border-color:#f0f8fc}#yddWrapper .ydd-sp{background-image:url(chrome-extension://eopjamdnofihpioajgfdikhhbobonhbb/ydd-sprite.png)}#yddWrapper a,#yddWrapper a:hover,#yddWrapper a:visited{color:#50799b}#yddWrapper .ydd-tabs{color:#959595}.ydd-tabs,.ydd-tab{background:#fff;border-color:#d5e7f3}#yddBottom{color:#363636}#yddWrapper{min-width:250px;max-width:400px;}</style></html>